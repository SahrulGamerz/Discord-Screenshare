FROM ubuntu:20.04

# Install dependencies
RUN apt-get update
RUN apt-get install -y curl git unzip wget build-essential libevent-dev libicu-dev libjpeg62-dev libvpx-dev
RUN DEBIAN_FRONTEND=noninteractive TZ=Etc/UTC apt-get -y install tzdata
RUN curl -fsSL https://deb.nodesource.com/setup_17.x | bash -
RUN apt-get install -y nodejs
RUN npm i -g yarn

# Clone Repo
RUN git clone https://github.com/SahrulGamerz/Discord-Screenshare.git
WORKDIR Discord-Screenshare
RUN yarn install
COPY .env .

# Install chromium 89
RUN wget http://ftp.jp.debian.org/debian/pool/main/c/chromium/chromium-sandbox_89.0.4389.114-1~deb10u1_arm64.deb
RUN apt-get install -y ./chromium-sandbox_89.0.4389.114-1~deb10u1_arm64.deb

RUN wget http://ftp.jp.debian.org/debian/pool/main/c/chromium/chromium-common_89.0.4389.114-1~deb10u1_arm64.deb
RUN apt-get install -y ./chromium-common_89.0.4389.114-1~deb10u1_arm64.deb

RUN wget http://ftp.jp.debian.org/debian/pool/main/c/chromium/chromium_89.0.4389.114-1~deb10u1_arm64.deb
RUN apt-get install -y ./chromium_89.0.4389.114-1~deb10u1_arm64.deb

# Install chromedriver 89
# RUN wget https://chromedriver.storage.googleapis.com/88.0.4324.27/chromedriver_linux64.zip
RUN wget https://chromedriver.storage.googleapis.com/89.0.4389.23/chromedriver_linux64.zip
RUN unzip chromedriver_linux64.zip
RUN mv chromedriver /bin

# Start Bot
RUN yarn start
